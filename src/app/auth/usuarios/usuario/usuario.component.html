<app-title title="Opciones de Usuario"/>

<div class="flex flex-col sm:flex-row">
    <!-- Contenedor Izquierdo: Perfil -->
    <div class="w-full  sm:mb-0">
      <div class="w-full max-w p-4">
        <div class="relative flex items-center space-x-4">
          @if(imageUrl != null)
          {
            <img [src]="imageUrl" alt="Imagen de Perfil" class="w-32 h-32 sm:w-40 sm:h-40 rounded-full" />
          }
          @else
          {
            <img class="w-12 h-12 rounded-full" src="/assets/img/avatar.svg" alt="user photo">
          }
    
          <div class="flex-1">
            <h5 class="text-xl sm:text-2xl font-bold tracking-tight text-gray-900 dark:text-white">
              {{trabajadorUser().nombres}} {{trabajadorUser().apellidos}}
            </h5>
            <p class="text-lg text-gray-500 dark:text-gray-400">Cédula: {{trabajadorUser().dni}}</p>
            <p class="text-lg text-gray-500 dark:text-gray-400">INSS: {{trabajadorUser().codigo}}</p>
          </div>
        </div>
      </div>
    </div>
    
  
    <!-- Contenedor Derecho: Información Personal e Información de Contacto -->
    <div class="flex flex-col w-full sm:w-2/3">
      <div class="max-w p-6 bg-white border border-gray-200 rounded-lg shadow dark:bg-gray-800 dark:border-gray-700">
 
            <h5 class="mb-2 text-2xl font-bold tracking-tight text-gray-900 dark:text-white">Opciones de Usuario</h5>
      

            @if(trabajadorUser().correo!==null)
            {
             
              <p class="text-lg text-gray-500 dark:text-gray-400">Usuario: {{trabajadorUser().correo}}</p>
            

        
            <button (click)="openModalResetPass()"  type="button" title="Cambiar Contraseña" class=" mt-3 inline-flex items-center text-yellow-300 hover:text-white border border-yellow-600 hover:bg-yellow-300 focus:ring-4 focus:outline-none focus:ring-yellow-300 font-medium rounded-lg text-sm px-5 py-2.5 text-center me-2 mb-2 dark:border-yellow-300 dark:text-yellow-300 dark:hover:text-white dark:hover:bg-yellow-400 dark:focus:ring-yellow-900">
              
                  <svg class="w-6 h-6 " aria-hidden="true" xmlns="http://www.w3.org/2000/svg"  fill="currentColor"  width="24" height="24" viewBox="0 0 64 64">
                    <path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="5"  d="M 32 6 C 23.716 6 17 12.716 17 21 C 17 27.143736 20.698333 32.417464 25.986328 34.736328 L 25.986328 52.087891 C 25.986328 52.926891 26.336125 
                    53.727875 26.953125 54.296875 L 30.205078 57.296875 C 31.199078 58.213875 32.745734 58.161641 33.677734 57.181641 L 39.427734 51.132812 C 39.911734 
                    50.684813 40.05425 49.976 39.78125 49.375 L 38.007812 45.46875 L 38.007812 45.373047 L 40.417969 42.386719 C 41.142969 41.487719 41.178812 40.215391 
                    40.507812 39.275391 L 38.007812 35.777344 L 38.007812 34.738281 C 43.298813 32.420697 47 27.145915 47 21 C 47 12.716 40.284 6 32 6 z M 32 12 C 34.209 
                    12 36 13.791 36 16 C 36 18.209 34.209 20 32 20 C 29.791 20 28 18.209 28 16 C 28 13.791 29.791 12 32 12 z"></path>
                    </svg>
            </button>
            
            
            <button (click)="openModalChangeEmail()" type="button" title="Cambiar dirección de Correo" class=" mt-3 inline-flex items-center text-yellow-300 hover:text-white border border-yellow-600 hover:bg-yellow-300 focus:ring-4 focus:outline-none focus:ring-yellow-300 font-medium rounded-lg text-sm px-5 py-2.5 text-center me-2 mb-2 dark:border-yellow-300 dark:text-yellow-300 dark:hover:text-white dark:hover:bg-yellow-400 dark:focus:ring-yellow-900">
              
              <svg class="w-6 h-6 " aria-hidden="true" xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="currentColor" viewBox="0 0 24 24">
                <path fill-rule="evenodd" d="M5 8a4 4 0 1 1 7.796 1.263l-2.533 2.534A4 4 0 0 1 5 8Zm4.06 5H7a4 4 0 0 0-4 4v1a2 2 0 0 0 2 2h2.172a2.999 2.999 0 0 1-.114-1.588l.674-3.372a3 3 0 0 1 .82-1.533L9.06 13Zm9.032-5a2.907 2.907 0 0 0-2.056.852L9.967 14.92a1 1 0 0 0-.273.51l-.675 3.373a1 1 0 0 0 1.177 1.177l3.372-.675a1 1 0 0 0 .511-.273l6.07-6.07a2.91 2.91 0 0 0-.944-4.742A2.907 2.907 0 0 0 18.092 8Z" clip-rule="evenodd"/>
              </svg>
              
            </button>
           

            <button (click)="openModalDelete()" type="button" title="Eliminar Usuario" class="mt-3  text-red-700 hover:text-white border border-red-700 hover:bg-red-800 focus:ring-4 focus:outline-none focus:ring-red-300 font-medium rounded-lg text-sm px-5 py-2.5 text-center me-2 mb-2 dark:border-red-500 dark:text-red-500 dark:hover:text-white dark:hover:bg-red-600 dark:focus:ring-red-900">  <svg class="w-6 h-6 " aria-hidden="true" xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="currentColor" viewBox="0 0 24 24">
              <path fill-rule="evenodd" d="M5 8a4 4 0 1 1 8 0 4 4 0 0 1-8 0Zm-2 9a4 4 0 0 1 4-4h4a4 4 0 0 1 4 4v1a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-1Zm13-6a1 1 0 1 0 0 2h4a1 1 0 1 0 0-2h-4Z" clip-rule="evenodd"/>
            </svg>
          </button>

         
            }
            @else
            {
                <p class="mb-3 font-normal text-gray-700 dark:text-gray-400">Este trabajador no tiene una cuenta de usuario activa. para crear o activar una cuenta de usuario haga click en el boton de abajo</p>
               

                <button (click)="CrearRestaurarUsuario()" type="button" class="inline-flex items-center text-blue-700 hover:text-white border border-blue-700 hover:bg-blue-800 focus:ring-4 focus:outline-none focus:ring-blue-300 font-medium rounded-lg text-sm px-5 py-2.5 text-center me-2 mb-2 dark:border-blue-500 dark:text-blue-500 dark:hover:text-white dark:hover:bg-blue-500 dark:focus:ring-blue-800">
                    <svg class="w-6 h-6 mr-2" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24">
                        <path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 12h4m-2 2v-4M4 18v-1a3 3 0 0 1 3-3h4a3 3 0 0 1 3 3v1a1 1 0 0 1-1 1H5a1 1 0 0 1-1-1Zm8-10a3 3 0 1 1-6 0 3 3 0 0 1 6 0Z"/>
                      </svg>
                    Activar o Crear Usuario
                </button>
    
            }

       
    </div>
    
    </div>
  </div>

  @if(trabajUser().userId!==null )
  {
    <div class="w-full p-4 text-center bg-white border border-gray-200 rounded-lg shadow sm:p-8 dark:bg-gray-800 dark:border-gray-700">

      <div class="grid grid-cols-1 gap-4 md:grid-cols-2">
        <div>
          <label class="block mb-2 text-sm font-medium text-gray-900 dark:text-white">Seleccione un Modulo</label>
          <select id="moduloId" formControlName="moduloId" (change)="onSelectedModulo($event)" name="moduloId"
            class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block w-full p-2.5 dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-white dark:focus:ring-blue-500 dark:focus:border-blue-500">
            <option value="">--- Seleccione ---</option>
            @for (item of moduloList(); track item.id) {
              <option [value]="item.id">{{item.titulo}}</option>
            }
          </select>
        </div>
      
        <div class="pt-3">
          <mat-form-field class="w-full">
            <mat-label>Seleccione un SubModulo</mat-label>
            <input (input)="filterSubModulos($event)" type="text" matInput aria-label="Titulo" required [matAutocomplete]="auto" #inputRef>
            <mat-autocomplete [displayWith]="displayFn" #auto="matAutocomplete" id="subModuloId" formControlName="subModuloId"
              name="subModuloId" (optionSelected)="onSelectSubModulo($event)">
              @for (item of filteredSubModulos; track item.id) {
                <mat-option [value]="item">
                  <span>{{item.titulo}}</span>
                </mat-option>
              }
            </mat-autocomplete>
          </mat-form-field>
        </div>
      </div>
    
      <div class="relative overflow-x-auto mt-3">
        <table class="w-full text-sm text-left rtl:text-right text-gray-500 dark:text-gray-400">
         
          <thead class="text-xs text-gray-700 uppercase bg-gray-50 dark:bg-gray-700 dark:text-gray-400">
            <tr>
              <th scope="col" class="px-4 py-3">SubModulo</th>
              <th scope="col" class="px-4 py-3">Acción</th>
            </tr>
          </thead>
          <tbody>
            @for (itemI of ModulosInSubMod(); track $index) {
              <h3 class="text-sm mt-2 font-semibold text-gray-900 dark:text-white mb-2">
                {{ itemI.titulo }}<span class="text-xs font-mono">(Módulo)</span>
              </h3>
            @for (item of subModuloByUserList(); track item.id) {
            @if(item.subModulo.moduloId==itemI.id) {
            <tr class="bg-white border-b dark:bg-gray-800 dark:border-gray-700">
              <td class="px-4 py-4 font-medium text-gray-900 whitespace-nowrap dark:text-white">
                {{item.subModulo.titulo}}
              </td>
              <td class="px-4 py-4">
                <a (click)="deleteSubModuloXUsuario(item)" title="Eliminar"
                  class="font-medium text-blue-600 dark:text-blue-500 hover:underline cursor-pointer">
                  <svg class="w-6 h-6 text-gray-800 dark:text-white" xmlns="http://www.w3.org/2000/svg" width="24" height="24"
                    fill="none" viewBox="0 0 24 24">
                    <path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                      d="M5 7h14m-9 3v8m4-8v8M10 3h4a1 1 0 0 1 1 1v3H9V4a1 1 0 0 1 1-1ZM6 7h12v13a1 1 0 0 1-1 1H7a1 1 0 0 1-1-1V7Z" />
                  </svg>
                </a>
              </td>
            </tr>
            }
            }}
          </tbody>
          
        </table>
      </div>
    
      <nav class="flex flex-col items-center justify-center space-y-2 mt-4 md:flex-row md:justify-between md:space-y-0" aria-label="Table navigation modal">
        <span class="text-sm font-normal text-gray-500 dark:text-gray-400 mb-4 md:mb-0 block w-full md:inline md:w-auto">Mostrando <span class="font-semibold text-gray-900 dark:text-white">{{subModuloByUserList().length}}</span> de <span class="font-semibold text-gray-900 dark:text-white">{{pagSM.contadorTotal}}</span></span>
         
        <ul class="inline-flex flex-wrap -space-x-px rtl:space-x-reverse text-sm h-8">
          <li>
            <button (click)="previousPage()">
              <a class="flex items-center justify-center px-3 h-8 ms-0 leading-tight text-gray-500 bg-white border border-gray-300 rounded-l-lg 
                hover:bg-gray-100 hover:text-gray-700 dark:bg-gray-800 dark:border-gray-700 dark:text-gray-400 dark:hover:bg-gray-700 dark:hover:text-white">
                <span class="sr-only">Previous</span>
                <svg class="w-2.5 h-2.5 rtl:rotate-180" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 6 10">
                  <path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 1 1 5l4 4"/>
                </svg>
              </a>
            </button>
          </li> 
          <li>
            <button (click)="nextPage()">
              <a class="flex items-center justify-center px-3 h-8 leading-tight text-gray-500 bg-white border border-gray-300 rounded-r-lg 
                hover:bg-gray-100 hover:text-gray-700 dark:bg-gray-800 dark:border-gray-700 dark:text-gray-400 dark:hover:bg-gray-700 dark:hover:text-white">
                <span class="sr-only">Next</span>
                <svg class="w-2.5 h-2.5 rtl:rotate-180" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 6 10">
                  <path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="m1 9 4-4-4-4"/>
                </svg>
              </a>
            </button>
          </li>
        </ul>
      </nav>
    </div>
  }
  @else
  {
    <div class="w-full mt-2 p-4 text-center bg-white border border-gray-200 rounded-lg shadow sm:p-8 dark:bg-gray-800 dark:border-gray-700">

        <p class="mb-3 font-normal text-gray-700 dark:text-gray-400">Este trabajador no tiene una cuenta de usuario. Para crear o activar una cuenta de usuario haga click en el boton "Activar o Crear Usuario"</p>
              
    </div>
  }


  <app-usuario-reset-pass-modal></app-usuario-reset-pass-modal>
  <app-usuario-reset-email-modal (emailOutput)="actualizarCorreo($event)"></app-usuario-reset-email-modal>
  <app-usuario-eliminar-modal (emailOutput)="actualizarPagina($event)"></app-usuario-eliminar-modal>
  <app-usuarios-crear (emailOutput)="actualizarPagina($event)"></app-usuarios-crear> 